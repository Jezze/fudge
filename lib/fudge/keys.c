#include "buffer.h"
#include "keys.h"

static unsigned int qwerty_us[128] = {
    0,
    KEYS_KEY_ESCAPE,
    KEYS_KEY_1,
    KEYS_KEY_2,
    KEYS_KEY_3,
    KEYS_KEY_4,
    KEYS_KEY_5,
    KEYS_KEY_6,
    KEYS_KEY_7,
    KEYS_KEY_8,
    KEYS_KEY_9,
    KEYS_KEY_0,
    KEYS_KEY_MINUS,
    KEYS_KEY_EQUAL,
    KEYS_KEY_BACKSPACE,
    KEYS_KEY_TAB,
    KEYS_KEY_Q,
    KEYS_KEY_W,
    KEYS_KEY_E,
    KEYS_KEY_R,
    KEYS_KEY_T,
    KEYS_KEY_Y,
    KEYS_KEY_U,
    KEYS_KEY_I,
    KEYS_KEY_O,
    KEYS_KEY_P,
    KEYS_KEY_LBRACKET,
    KEYS_KEY_RBRACKET,
    KEYS_KEY_ENTER,
    KEYS_KEY_LCONTROL,
    KEYS_KEY_A,
    KEYS_KEY_S,
    KEYS_KEY_D,
    KEYS_KEY_F,
    KEYS_KEY_G,
    KEYS_KEY_H,
    KEYS_KEY_J,
    KEYS_KEY_K,
    KEYS_KEY_L,
    KEYS_KEY_SEMICOLON,
    KEYS_KEY_SINGLEQUOTE,
    KEYS_KEY_BACKTICK,
    KEYS_KEY_LSHIFT,
    KEYS_KEY_BACKSLASH,
    KEYS_KEY_Z,
    KEYS_KEY_X,
    KEYS_KEY_C,
    KEYS_KEY_V,
    KEYS_KEY_B,
    KEYS_KEY_N,
    KEYS_KEY_M,
    KEYS_KEY_COMMA,
    KEYS_KEY_PERIOD,
    KEYS_KEY_SLASH,
    KEYS_KEY_RSHIFT,
    KEYS_KEY_KEYPAD_STAR,
    KEYS_KEY_LALT,
    KEYS_KEY_SPACE,
    KEYS_KEY_CAPSLOCK,
    KEYS_KEY_F1,
    KEYS_KEY_F2,
    KEYS_KEY_F3,
    KEYS_KEY_F4,
    KEYS_KEY_F5,
    KEYS_KEY_F6,
    KEYS_KEY_F7,
    KEYS_KEY_F8,
    KEYS_KEY_F9,
    KEYS_KEY_F10,
    KEYS_KEY_NUMLOCK,
    KEYS_KEY_SCROLLLOCK,
    KEYS_KEY_KEYPAD_7,
    KEYS_KEY_KEYPAD_8,
    KEYS_KEY_KEYPAD_9,
    KEYS_KEY_KEYPAD_MINUS,
    KEYS_KEY_KEYPAD_4,
    KEYS_KEY_KEYPAD_5,
    KEYS_KEY_KEYPAD_6,
    KEYS_KEY_KEYPAD_PLUS,
    KEYS_KEY_KEYPAD_1,
    KEYS_KEY_KEYPAD_2,
    KEYS_KEY_KEYPAD_3,
    KEYS_KEY_KEYPAD_0,
    KEYS_KEY_KEYPAD_PERIOD,
    0,
    0,
    0,
    KEYS_KEY_F11,
    KEYS_KEY_F12,
    0
};

static unsigned int qwerty_us_extended[128] = {
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    KEYS_KEY_PREVIOUSTRACK,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    KEYS_KEY_NEXTTRACK,
    0,
    0,
    KEYS_KEY_KEYPAD_ENTER,
    KEYS_KEY_RCONTROL,
    0,
    0,
    KEYS_KEY_MUTE,
    KEYS_KEY_CALCULATOR,
    KEYS_KEY_PLAY,
    0,
    KEYS_KEY_STOP,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    KEYS_KEY_VOLUMEDOWN,
    0,
    KEYS_KEY_VOLUMEUP,
    0,
    KEYS_KEY_WEBHOME,
    0,
    0,
    KEYS_KEY_KEYPAD_SLASH,
    0,
    0,
    KEYS_KEY_RALT,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    KEYS_KEY_HOME,
    KEYS_KEY_CURSORUP,
    KEYS_KEY_PAGEUP,
    0,
    KEYS_KEY_CURSORLEFT,
    0,
    KEYS_KEY_CURSORRIGHT,
    0,
    KEYS_KEY_END,
    KEYS_KEY_CURSORDOWN,
    KEYS_KEY_PAGEDOWN,
    KEYS_KEY_INSERT,
    KEYS_KEY_DELETE,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    KEYS_KEY_LMETA,
    KEYS_KEY_RMETA,
    KEYS_KEY_APPS,
    KEYS_KEY_POWER,
    KEYS_KEY_SLEEP,
    0,
    0,
    0,
    KEYS_KEY_WAKE,
    0,
    KEYS_KEY_WEBSEARCH,
    KEYS_KEY_FAVOURITES,
    KEYS_KEY_REFRESH,
    KEYS_KEY_WEBSTOP,
    KEYS_KEY_WEBFORWARD,
    KEYS_KEY_WEBBACK,
    KEYS_KEY_MYCOMPUTER,
    KEYS_KEY_EMAIL,
    KEYS_KEY_MEDIASELECT,
    0
};

static struct keys_map map_us[256] = {
    {{{0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x31, 0x00, 0x00, 0x00}}, {1, {0x21, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x32, 0x00, 0x00, 0x00}}, {1, {0x40, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x33, 0x00, 0x00, 0x00}}, {1, {0x23, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x34, 0x00, 0x00, 0x00}}, {1, {0x24, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x35, 0x00, 0x00, 0x00}}, {1, {0x25, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x36, 0x00, 0x00, 0x00}}, {1, {0x5E, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x37, 0x00, 0x00, 0x00}}, {1, {0x26, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x38, 0x00, 0x00, 0x00}}, {1, {0x2A, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x39, 0x00, 0x00, 0x00}}, {1, {0x28, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x30, 0x00, 0x00, 0x00}}, {1, {0x29, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x2D, 0x00, 0x00, 0x00}}, {1, {0x5F, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x3D, 0x00, 0x00, 0x00}}, {1, {0x2B, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x08, 0x00, 0x00, 0x00}}, {1, {0x08, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x09, 0x00, 0x00, 0x00}}, {1, {0x09, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x71, 0x00, 0x00, 0x00}}, {1, {0x51, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x77, 0x00, 0x00, 0x00}}, {1, {0x57, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x65, 0x00, 0x00, 0x00}}, {1, {0x45, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x72, 0x00, 0x00, 0x00}}, {1, {0x52, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x74, 0x00, 0x00, 0x00}}, {1, {0x54, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x79, 0x00, 0x00, 0x00}}, {1, {0x59, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x75, 0x00, 0x00, 0x00}}, {1, {0x55, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x69, 0x00, 0x00, 0x00}}, {1, {0x49, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x6F, 0x00, 0x00, 0x00}}, {1, {0x4F, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x70, 0x00, 0x00, 0x00}}, {1, {0x50, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x5B, 0x00, 0x00, 0x00}}, {1, {0x7B, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x5D, 0x00, 0x00, 0x00}}, {1, {0x7D, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x0A, 0x00, 0x00, 0x00}}, {1, {0x0A, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x61, 0x00, 0x00, 0x00}}, {1, {0x41, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x73, 0x00, 0x00, 0x00}}, {1, {0x53, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x64, 0x00, 0x00, 0x00}}, {1, {0x44, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x66, 0x00, 0x00, 0x00}}, {1, {0x46, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x67, 0x00, 0x00, 0x00}}, {1, {0x47, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x68, 0x00, 0x00, 0x00}}, {1, {0x48, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x6A, 0x00, 0x00, 0x00}}, {1, {0x4A, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x6B, 0x00, 0x00, 0x00}}, {1, {0x4B, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x6C, 0x00, 0x00, 0x00}}, {1, {0x4C, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x3B, 0x00, 0x00, 0x00}}, {1, {0x3A, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x27, 0x00, 0x00, 0x00}}, {1, {0x22, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x60, 0x00, 0x00, 0x00}}, {1, {0x7E, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x5C, 0x00, 0x00, 0x00}}, {1, {0x7C, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x7A, 0x00, 0x00, 0x00}}, {1, {0x5A, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x78, 0x00, 0x00, 0x00}}, {1, {0x58, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x63, 0x00, 0x00, 0x00}}, {1, {0x43, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x76, 0x00, 0x00, 0x00}}, {1, {0x56, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x62, 0x00, 0x00, 0x00}}, {1, {0x42, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x6E, 0x00, 0x00, 0x00}}, {1, {0x4E, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x6D, 0x00, 0x00, 0x00}}, {1, {0x4D, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x2C, 0x00, 0x00, 0x00}}, {1, {0x3C, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x2E, 0x00, 0x00, 0x00}}, {1, {0x3E, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x2F, 0x00, 0x00, 0x00}}, {1, {0x3F, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x20, 0x00, 0x00, 0x00}}, {1, {0x20, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
};

static struct keys_map map_se[256] = {
    {{{0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x31, 0x00, 0x00, 0x00}}, {1, {0x21, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x32, 0x00, 0x00, 0x00}}, {1, {0x40, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x33, 0x00, 0x00, 0x00}}, {1, {0x23, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x34, 0x00, 0x00, 0x00}}, {1, {0x24, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x35, 0x00, 0x00, 0x00}}, {1, {0x25, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x36, 0x00, 0x00, 0x00}}, {1, {0x5E, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x37, 0x00, 0x00, 0x00}}, {1, {0x26, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x38, 0x00, 0x00, 0x00}}, {1, {0x2A, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x39, 0x00, 0x00, 0x00}}, {1, {0x28, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x30, 0x00, 0x00, 0x00}}, {1, {0x29, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x2D, 0x00, 0x00, 0x00}}, {1, {0x5F, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x3D, 0x00, 0x00, 0x00}}, {1, {0x2B, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x08, 0x00, 0x00, 0x00}}, {1, {0x08, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x09, 0x00, 0x00, 0x00}}, {1, {0x09, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x71, 0x00, 0x00, 0x00}}, {1, {0x51, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x77, 0x00, 0x00, 0x00}}, {1, {0x57, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x65, 0x00, 0x00, 0x00}}, {1, {0x45, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x72, 0x00, 0x00, 0x00}}, {1, {0x52, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x74, 0x00, 0x00, 0x00}}, {1, {0x54, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x79, 0x00, 0x00, 0x00}}, {1, {0x59, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x75, 0x00, 0x00, 0x00}}, {1, {0x55, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x69, 0x00, 0x00, 0x00}}, {1, {0x49, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x6F, 0x00, 0x00, 0x00}}, {1, {0x4F, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x70, 0x00, 0x00, 0x00}}, {1, {0x50, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x5B, 0x00, 0x00, 0x00}}, {1, {0x7B, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x5D, 0x00, 0x00, 0x00}}, {1, {0x7D, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x0A, 0x00, 0x00, 0x00}}, {1, {0x0A, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x61, 0x00, 0x00, 0x00}}, {1, {0x41, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x73, 0x00, 0x00, 0x00}}, {1, {0x53, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x64, 0x00, 0x00, 0x00}}, {1, {0x44, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x66, 0x00, 0x00, 0x00}}, {1, {0x46, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x67, 0x00, 0x00, 0x00}}, {1, {0x47, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x68, 0x00, 0x00, 0x00}}, {1, {0x48, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x6A, 0x00, 0x00, 0x00}}, {1, {0x4A, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x6B, 0x00, 0x00, 0x00}}, {1, {0x4B, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x6C, 0x00, 0x00, 0x00}}, {1, {0x4C, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x3B, 0x00, 0x00, 0x00}}, {1, {0x3A, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x27, 0x00, 0x00, 0x00}}, {1, {0x22, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x60, 0x00, 0x00, 0x00}}, {1, {0x7E, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x5C, 0x00, 0x00, 0x00}}, {1, {0x7C, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x7A, 0x00, 0x00, 0x00}}, {1, {0x5A, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x78, 0x00, 0x00, 0x00}}, {1, {0x58, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x63, 0x00, 0x00, 0x00}}, {1, {0x43, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x76, 0x00, 0x00, 0x00}}, {1, {0x56, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x62, 0x00, 0x00, 0x00}}, {1, {0x42, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x6E, 0x00, 0x00, 0x00}}, {1, {0x4E, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x6D, 0x00, 0x00, 0x00}}, {1, {0x4D, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x2C, 0x00, 0x00, 0x00}}, {1, {0x3C, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x2E, 0x00, 0x00, 0x00}}, {1, {0x3E, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x2F, 0x00, 0x00, 0x00}}, {1, {0x3F, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
    {{{1, {0x20, 0x00, 0x00, 0x00}}, {1, {0x20, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}, {0, {0x00, 0x00, 0x00, 0x00}}}},
};

static unsigned int *getlayout(unsigned int type, unsigned int extended)
{

    switch (type)
    {

    case KEYS_LAYOUT_QWERTY_US:
        return (extended) ? qwerty_us_extended : qwerty_us;

    }

    return 0;

}

static struct keys_map *getmap(unsigned int type)
{

    switch (type)
    {

    case KEYS_MAP_US:
        return map_us;

    case KEYS_MAP_SE:
        return map_se;

    }

    return 0;

}

static void update(struct keys *keys, unsigned int type, unsigned int offset, unsigned int release)
{

    unsigned int *layout = getlayout(type, keys->extended);

    keys->id = (layout) ? layout[offset] : 0;

    if (release)
    {

        switch (keys->id)
        {

        case KEYS_KEY_LCONTROL:
        case KEYS_KEY_RCONTROL:
            keys->mod &= ~KEYS_MOD_CTRL;

            break;

        case KEYS_KEY_LSHIFT:
        case KEYS_KEY_RSHIFT:
            keys->mod &= ~KEYS_MOD_SHIFT;

            break;

        case KEYS_KEY_LALT:
        case KEYS_KEY_RALT:
            keys->mod &= ~KEYS_MOD_ALT;

            break;

        case KEYS_KEY_LMETA:
        case KEYS_KEY_RMETA:
            keys->mod &= ~KEYS_MOD_META;

            break;

        }

    }

    else
    {

        switch (keys->id)
        {

        case KEYS_KEY_LCONTROL:
        case KEYS_KEY_RCONTROL:
            keys->mod |= KEYS_MOD_CTRL;

            break;

        case KEYS_KEY_LSHIFT:
        case KEYS_KEY_RSHIFT:
            keys->mod |= KEYS_MOD_SHIFT;

            break;

        case KEYS_KEY_LALT:
        case KEYS_KEY_RALT:
            keys->mod |= KEYS_MOD_ALT;

            break;

        case KEYS_KEY_LMETA:
        case KEYS_KEY_RMETA:
            keys->mod |= KEYS_MOD_META;

            break;

        }

    }

}

unsigned int keys_getcode(struct keys *keys, unsigned int scancode)
{

    if (scancode == 0xE0)
    {

        keys->extended = 1;
        keys->id = 0;
        keys->code.length = 0;

    }

    else
    {

        unsigned int offset = scancode & 0x7F;
        unsigned int release = scancode & 0x80;

        update(keys, keys->layout, offset, release);

        if (offset)
        {

            struct keys_map *map = getmap(keys->layout);

            if (map)
            {

                struct keys_code *code = &map[offset].code[(keys->mod & KEYS_MOD_SHIFT) ? 1 : 0];

                buffer_copy(&keys->code, code, sizeof (struct keys_code));

            }

        }

        keys->extended = 0;

    }

    return keys->id;

}

void keys_init(struct keys *keys, unsigned int layout, unsigned int map)
{

    keys->layout = layout;
    keys->map = map;
    keys->extended = 0;
    keys->mod = 0;
    keys->id = 0;
    keys->code.length = 0;

}

